# === 基本設定 ===

# True Color サポート（WezTerm + Neovim 連携）
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# カーソル形状のパススルー（Neovim の insert/normal 切替）
set -ga terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q'

# クリップボード（WezTerm の OSC 52 経由でシステムクリップボードと連携）
set -g set-clipboard on

# Undercurl サポート（Neovim diagnostics の波線表示）
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'

# マウス操作を有効化
set -g mouse on

# ESC キーの遅延をなくす（Neovim のモード切替を高速に）
set -sg escape-time 0

# スクロールバック行数
set -g history-limit 10000

# コピーモードを vi キーバインドにする
set -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel

# ステータスバー
set -g status-style 'bg=default'
set -g status-left '#[bg=#D27E99,fg=#FFF0F3,bold] #{session_name} #[default] '
set -g status-right ''
set -g window-status-format '#[bg=colour236,fg=colour245] #I:#W #[default]'
set -g window-status-current-format '#[bg=green,fg=colour232,bold] #I:#W #[default]'
set -g window-status-separator ' '

# ペイン境界線
set -g pane-border-lines heavy
set -g pane-border-indicators colour
set -g pane-active-border-style 'fg=green,bg=default'
set -g pane-border-style 'fg=#444444'
set -g pane-border-status top
set -g pane-border-format ' #{pane_index}: #{pane_current_command} '

# === ペイン操作 ===

# 分割（| で縦、- で横。現在のディレクトリを引き継ぐ）
bind | split-window -h -c '#{pane_current_path}'
bind - split-window -v -c '#{pane_current_path}'

# ペイン移動（hjkl）
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ペインリサイズ（H/J/K/L で5セルずつ）
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ペイン入れ替え（フォーカスは現在位置に留まる）
bind -r '}' swap-pane -D -d
bind -r '{' swap-pane -U -d

# フローティングウィンドウ（Ctrl-f で開く、popup 内の Ctrl-f で閉じる）
bind -n C-f display-popup -E -e TMUX_POPUP=1 -d '#{pane_current_path}' -w 80% -h 80%

# ペインスクロール（半ページ、wezterm の Cmd+j/k から user-keys 経由で呼び出し）
set -s user-keys[0] "\033[34~"
set -s user-keys[1] "\033[35~"
bind -T root User0 copy-mode -e \; send-keys -X halfpage-up
bind -T copy-mode-vi User0 send-keys -X halfpage-up
bind -T copy-mode-vi User1 send-keys -X halfpage-down

# ペインを閉じる（確認なし）
bind x kill-pane

# === ウィンドウ移動 ===

# Ctrl+Tab / Ctrl+Shift+Tab は WezTerm 側で prefix+n/p に変換

