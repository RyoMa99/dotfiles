# Terraform 新規リソース作成ガイドライン

Terraform コードを書く時、AWS リソースを追加する時に適用する。

このスキルは新規リソース作成時のガイドラインです。既存リソースを無理やり変更する必要はありません。

## 1. リポジトリ管理

- **Terraformはアプリケーションリポジトリ側で管理する**
  - 開発者の認知負荷を下げるため
  - メインサービス（管理画面、EC画面など）と同じ構成に揃える

## 2. ディレクトリ構成

- **環境ごとにディレクトリを切らない**
  - 環境差分はすべてコード上（count、三項演算子など）で表現する
  - 本番-STG-DEV間の意図しない差分を許容しない

## 3. リソース命名規則

- **グローバルユニークでないリソースに環境名を入れない**
  - AWSアカウントIDやエイリアスで環境判断可能
  - 例外: S3など、グローバルユニークが強制されるもの
- **環境間で命名を揃える**
  - 悪い例: `hogepiyo-cluster`（本番）vs `hogepiyo-stg-cluster`（STG）
  - GitHub Actions等のmatrix表現が困難になるため

## 4. Terraform Cloud

- **Terraform Cloudでのみapplyを許容**
  - いつ・誰がリソースを変更したか追跡可能にする
  - 手元でのapplyを禁止

## 5. ECSサービス管理

- **ecspressoで管理する**
  - ALB紐付けが不要なサービスはTerraform管理のメリットがない

## 6. タグ付け

- **すべてのリソースにタグを設定**
  - コスト管理タグ
  - 管理リポジトリへのリンク
  - AWSアラート時に担当者・リポジトリを追跡可能にする

## 7. 開発環境の最適化

- SPOT導入を検討
- スケール設定の見直し
- Graviton化の検討
