# Plan モードの進め方

Plan モード（EnterPlanMode）に入った場合、以下の3フェーズで進める。

---

## Phase 1: 意図の明確化

調査に入る前に、ユーザーが何を達成したいかを明確にする。

- ユーザーの要求を自分の言葉で言い換え、認識が合っているか確認する
- 曖昧な点は `AskUserQuestion` で質問する（実装方針、優先度、制約など）
- 以下を明確にしてから Phase 2 に進む：
  - **ゴール**: 何を実現したいか
  - **制約**: 技術的制約、時間的制約、互換性要件
  - **スコープ**: 今回やること・やらないこと

> Phase 1 を省略しない。調査対象が明確でないまま Phase 2 に入ると、無関係なコードを読む時間が無駄になる。

---

## Phase 2: コードベース調査

Phase 1 で明確になったゴールに基づき、既存コードを調査する。

### 調査ツールの使い分け

@~/.claude/rules/code-search.md の判断フローに従う。

特に以下を積極的に活用する：

1. **Serena** - シンボル概要の把握、定義・参照の追跡
   - `get_symbols_overview`: プロジェクト構造の把握
   - `find_symbol`: 関連クラス・関数の特定
   - `find_referencing_symbols`: 影響範囲の特定
2. **grepai** - セマンティック検索で類似パターン発見（クエリは英語で）
3. **Grep / Glob** - パターンマッチによる検索

### 調査で明らかにすべきこと

- 変更が必要なファイルと影響範囲
- 既存の設計パターン・慣習
- 類似機能の既存実装（参考にできるコード）

---

## Phase 3: 計画策定

Phase 1 の意図と Phase 2 の調査結果に基づき、実装計画を作成する。

- 具体的な変更対象（ファイル・シンボル）を列挙
- タスクを依存関係に基づき順序付け
- リスクや判断が必要なポイントを明示
- ユーザーの承認を得てから実装に進む（`ExitPlanMode`）
