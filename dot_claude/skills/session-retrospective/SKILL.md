---
name: session-retrospective
description: "Use when ending a development session to capture learnings across 7 perspectives"
user-invocable: true
allowed-tools: ["Bash", "Read", "Write", "Edit", "Glob", "Grep", "AskUserQuestion"]
---

詳細な振り分け基準・自動化パターンは `reference.md` を Read して参照。

# Session Retrospective

セッションの振り返りを7つの観点で構造的に行い、得られた知見を適切な保存先に振り分ける。

## When to Use

- セッション終了時（`/implementation` スキルの Step 5）
- `/session-retrospective` コマンド
- 「振り返って」「まとめて」と依頼

## 7つの観点

| # | 観点 | 検出対象 | 保存先 |
|---|------|---------|--------|
| 1 | **ドメイン知識** | 業務ルール、用語、仕様理解 | `business_knowledge/` リポジトリ |
| 2 | **技術的学び** | 型設計、テスト、エラー解決パターン | `~/.claude/rules/` |
| 3 | **自動化機会** | 繰り返しパターン、定型操作 | hooks / skills / rules |
| 4 | **既存知識の更新** | 陳腐化した情報、矛盾する知見 | 該当ルールファイルを更新 |
| 5 | **プロジェクト CLAUDE.md** | 不足したコンテキスト | `./CLAUDE.md` or `.claude.local.md` |
| 6 | **較正の妥当性** | 計画時の較正と実装結果の乖離 | `plan-review-learnings.md` or `plan-mode.md` |
| 7 | **設計負債** | ゼロベース再設計で発見した設計の歪み | GitHub Issue（リファクタ） |

## 実行フロー

### Step 1: セッション走査

各観点で知見を抽出する。検出シグナル:

- **ドメイン知識**: 「〜という仕様」「〜というルール」、ビジネスロジック理解に背景知識が必要だった
- **技術的学び**: エラー解決、「こうすべき」と判明、設計パターン・型・テスト手法の新知見
- **自動化機会**: 同じチェックの手動実行、3ステップ以上の連続操作、「〜する前に確認して」パターン
- **既存知識の更新**: 既存ルールと矛盾する発見、バージョンアップで不要になった回避策
- **プロジェクト CLAUDE.md**: コンテキスト不足で非効率な動き、暗黙的な慣習の発見
- **較正の妥当性**: 較正メモがあるセッションのみ。計画時の較正判断と実装結果の整合性
- **設計負債**: 実装中に感じた設計の無理や妥協、「本当はこう設計すべき」という気づき。「この部分をゼロから再設計するなら？」と問いかけて検出

### Step 2: レポート提示

```markdown
## セッション振り返り

### 検出した知見

#### 🏢 ドメイン知識
| # | 内容 | ドメイン | 重要度 |
|---|------|---------|--------|

#### 🔧 技術的学び
| # | 内容 | カテゴリ | 保存先 |
|---|------|---------|--------|

#### ⚡ 自動化機会
| # | 内容 | 種類 | 信頼度 |
|---|------|------|--------|

#### 🔄 既存知識の更新
| # | 対象ファイル | 更新内容 | 理由 |
|---|-------------|---------|------|

#### 📋 プロジェクト CLAUDE.md
| # | 対象ファイル | 追記内容 | 理由 |
|---|-------------|---------|------|

#### 🎯 較正の妥当性
| # | 較正メモの判断 | 実装結果 | 評価 | 学び |
|---|--------------|---------|------|------|

#### 🏗️ 設計負債
| # | 対象領域 | 現状の設計 | 理想の設計 | Issue 化 |
|---|---------|-----------|-----------|----------|

---
該当なしの観点は省略。
保存する項目を選んでください（例: D1, T1, A1 / all / none）
```

### Step 3: ユーザー承認 → Step 4: 振り分け実行 → Step 5: 完了報告

承認された項目のみ保存。保存先の詳細は `reference.md` を参照。

## 重要なルール

1. **該当なしは正常** - 無理に検出しない
2. **ユーザー承認必須** - 自動保存しない
3. **既存知識の確認** - 追記前に必ず既存内容を読み、重複・矛盾を確認
4. **鮮度の意識** - 矛盾する場合は更新を提案（観点4）
5. **秘密情報除外** - APIキー、トークン、個人情報は含めない
6. **簡潔に** - 大量の知見を無理に絞り出さない
