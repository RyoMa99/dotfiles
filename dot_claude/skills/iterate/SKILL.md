---
name: iterate
description: /TDDスキルを最大3回反復し、テスト成功まで改善を続ける
user_invocable: true
---

# Iterate Skill

TDDスキルを最大3回反復し、テスト成功まで改善を続けるスキル。

## When to Use This Skill

Trigger when user:
- `/iterate` コマンドを実行
- 「反復して改善して」「3回やり直して」と依頼

## 動作概要

```
┌─────────────────────────────────────────────────────────────┐
│  /iterate 実行                                              │
│       ↓                                                     │
│  ステートファイル作成（.claude/iterate.local.md）           │
│       ↓                                                     │
│  /TDD スキルを実行                                          │
│       ↓                                                     │
│  ├── テスト成功（<tdd-success/>検出）→ 終了                │
│  └── テスト失敗 → 反復（最大3回）                          │
└─────────────────────────────────────────────────────────────┘
```

## 実行手順

### Step 1: ステートファイルを作成

以下の内容で `.claude/iterate.local.md` を作成してください：

```markdown
---
iteration: 1
max_iterations: 3
---

TDDサイクルを実行してください。
全てのテストが成功したら <tdd-success/> を出力してください。
```

**重要**: このファイルは必ず作成してください。stop hookがこのファイルを見て反復を制御します。

### Step 2: /TDD スキルを呼び出す

ステートファイル作成後、`/TDD` スキルを呼び出してください。

```
Skill tool で /TDD を実行
```

### Step 3: 結果に応じた動作

- **テスト成功**: `<tdd-success/>` を出力 → hookがステートファイルを削除して終了
- **テスト失敗**: hookが終了をブロックし、自動的に再度 /TDD が実行される

## 注意事項

- 通常の `/TDD` は反復しない（ステートファイルがないため）
- `/iterate` 経由の場合のみ反復が有効
- 最大3回で強制終了（無限ループ防止）
- ステートファイルは `.local.md` なので git 管理外

## キャンセル方法

反復を途中でキャンセルしたい場合：

```bash
rm .claude/iterate.local.md
```

または、Claude Code を終了してください。
