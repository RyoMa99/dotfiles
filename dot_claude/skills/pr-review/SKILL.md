---
name: pr-review
description: 現在いるブランチのPRのレビューをする。要約と詳細レビューの両方に対応。
argument-hint: "[summary|review|all]"
allowed-tools: ["Bash", "Glob", "Grep", "Read", "Task"]
---

# PR Review Skill

現在のブランチのPRを要約・レビューする統合スキル。

## When to Use This Skill

Trigger when user:
- `/pr-review` コマンドを実行
- 「PRをレビューして」「PRの内容を教えて」と依頼
- 現在のブランチのPR状態を確認したい場合

## 使用方法

```
/pr-review           # 要約 + クイックレビュー（デフォルト）
/pr-review summary   # 要約のみ
/pr-review review    # 詳細レビューのみ
/pr-review all       # 要約 + 全エージェントによる詳細レビュー
```

## 実行フロー

### Step 1: PR情報の取得

```bash
# 現在のブランチ名を取得
git branch --show-current

# PRの基本情報を取得
PAGER=cat gh pr view

# PRの差分を取得
PAGER=cat gh pr diff
```

### Step 2: 要約（デフォルトで実行）

取得した情報を基に、以下を日本語で要約：

```markdown
## PR要約

### 基本情報
- タイトル: ...
- 状態: ...
- レビュワー: ...

### 目的
このPRは〇〇を実現するために...

### 主な変更点
1. ...
2. ...

### 影響範囲
- ...
```

### Step 3: 詳細レビュー（オプション）

`review` または `all` が指定された場合、専門エージェントを起動：

**クイックレビュー（デフォルト）:**
- `code-reviewer` のみ起動（一般的なコード品質）

**詳細レビュー（`all` 指定時）:**
変更内容に応じて適切なエージェントを選択：

| エージェント | 対象 | 内容 |
|-------------|------|------|
| code-reviewer | 常に | 一般的なコード品質、CLAUDE.md準拠 |
| pr-test-analyzer | テストファイル変更時 | テストカバレッジ品質 |
| comment-analyzer | コメント追加時 | コメントの正確性 |
| silent-failure-hunter | エラー処理変更時 | サイレント失敗の検出 |
| type-design-analyzer | 型追加時 | 型設計の品質 |
| code-simplifier | レビュー通過後 | コードの簡素化 |

### Step 4: 結果のまとめ

```markdown
## レビュー結果

### Critical Issues（必ず修正）
- [エージェント名]: 問題の説明 [file:line]

### Important Issues（修正推奨）
- [エージェント名]: 問題の説明 [file:line]

### Suggestions（検討）
- [エージェント名]: 提案 [file:line]

### 良い点
- ...

### 推奨アクション
1. Critical Issuesを修正
2. Important Issuesに対応
3. 必要に応じて再レビュー
```

## エージェント呼び出し方法

詳細レビューは `pr-review-toolkit` プラグインのエージェントを使用：

```
# 特定のエージェントを呼び出す場合
Task tool で pr-review-toolkit のエージェントを起動

# 全エージェント並列実行
/pr-review-toolkit:review-pr all parallel
```

## Tips

- **まず要約から**: PR内容を把握してから詳細レビューへ
- **Critical優先**: Critical Issuesを先に修正
- **再レビュー**: 修正後は該当エージェントのみ再実行
- **コミット前に**: PRを作成する前にレビューを実行すると効果的

---

## コードレビュー観点（4カテゴリ）

### 1. セキュリティ（CRITICAL）

| チェック項目 | 説明 |
|-------------|------|
| 認証情報のハードコード | APIキー、パスワード、トークンが直接記述されていないか |
| SQLインジェクション | パラメータ化クエリを使用しているか |
| XSS脆弱性 | ユーザー入力がサニタイズされているか |
| 入力値検証 | すべてのユーザー入力が検証されているか |
| 脆弱な依存関係 | 既知の脆弱性を持つパッケージがないか |

### 2. コード品質（HIGH）

| チェック項目 | 基準 |
|-------------|------|
| 関数の長さ | 50行以下 |
| ファイルの長さ | 800行以下 |
| ネストの深さ | 4階層以下 |
| エラーハンドリング | 適切に実装されているか |
| テストカバレッジ | 新規コード80%以上 |

### 3. パフォーマンス（MEDIUM）

| チェック項目 | 説明 |
|-------------|------|
| アルゴリズム効率 | O(n²)以上の計算量がないか |
| React再レンダリング | 不要な再レンダリングがないか |
| メモ化 | useMemo/useCallbackが適切に使われているか |
| N+1クエリ | データベースアクセスが最適化されているか |

### 4. ベストプラクティス（MEDIUM）

| チェック項目 | 説明 |
|-------------|------|
| 命名規則 | 変数名・関数名が明確か |
| マジックナンバー | 定数として定義されているか |
| ドキュメント | 複雑なロジックにコメントがあるか |
| アクセシビリティ | a11y対応がされているか |

---

## 判定基準

| 状態 | 条件 | アクション |
|------|------|-----------|
| ✅ 承認 | CRITICAL/HIGH なし | マージ可能 |
| ⚠️ 条件付き承認 | MEDIUM のみ | 修正推奨だがマージ可 |
| ❌ 要修正 | CRITICAL/HIGH あり | 修正必須 |
